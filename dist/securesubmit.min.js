var Heartland=function(){"use strict";var e={};!function(){function t(e){return e<10?"0"+e:e}function r(e){return c.lastIndex=0,c.test(e)?'"'+e.replace(c,function(e){var t=l[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function n(e,t){var a,d,c,l,u=null,p=o,m=t[e];switch(m&&"object"==typeof m&&"function"==typeof m.toJSON&&(m=m.toJSON(e)),"function"==typeof s&&(m=s.call(t,e,m)),typeof m){case"string":return r(m);case"number":return isFinite(m)?String(m):"null";case"boolean":case"undefined":case"null":return String(m);case"object":if(!m)return"null";if(o+=i,l=[],"[object Array]"===Object.prototype.toString.apply(m,[])){for(c=m.length,a=0;a<c;a+=1)l[a]=n(a.toString(),m)||"null";return d=0===l.length?"[]":o?"[\n"+o+l.join(",\n"+o)+"\n"+p+"]":"["+l.join(",")+"]",o=p,d}if(s&&"object"==typeof s)for(c=s.length,a=0;a<c;a+=1)"string"==typeof s[a]&&(u=s[a],(d=n(u,m))&&l.push(r(u)+(o?": ":":")+d));else for(u in m)Object.prototype.hasOwnProperty.call(m,u)&&(d=n(u,m))&&l.push(r(u)+(o?": ":":")+d);return d=0===l.length?"{}":o?"{\n"+o+l.join(",\n"+o)+"\n"+p+"}":"{"+l.join(",")+"}",o=p,d}}if("function"!=typeof Date.prototype.toJSON){Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+t(this.getUTCMonth()+1)+"-"+t(this.getUTCDate())+"T"+t(this.getUTCHours())+":"+t(this.getUTCMinutes())+":"+t(this.getUTCSeconds())+"Z":null};var a=String.prototype;Number.prototype.JSON=a.JSON=Boolean.prototype.toJSON=function(e){return this.valueOf()}}var o,i,s,d=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,c=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,l={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};"function"!=typeof e.stringify&&(e.stringify=function(e,t,r){var a;if(o="",i="","number"==typeof r)for(a=0;a<r;a+=1)i+=" ";else"string"==typeof r&&(i=r);if(s=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return n("",{"":e})}),"function"!=typeof e.parse&&(e.parse=function(e,t){function r(e,n){var a,o=null,i=e[n];if(i&&"object"==typeof i)for(o in i)Object.prototype.hasOwnProperty.call(i,o)&&(a=r(i,o),i[o]=void 0!==a?a:void 0);return t.call(e,n,i)}var n;if(e=String(e),d.lastIndex=0,d.test(e)&&(e=e.replace(d,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(e.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return n=new Function("return ("+e+")")(),"function"==typeof t?r({"":n},""):n;throw new SyntaxError("JSON.parse")})}();var t=function(){function e(e,t){void 0===e&&(e=""),void 0===t&&(t=""),this.url=e,this.payload=t,this.type="jsonp"}return e}(),r=function(){function e(e){void 0===e&&(e={}),this.payload=e,this.type="null"}return e}(),n=function(){function t(){}return t.jsonp=function(e,t){var r=document.createElement("script"),n="jsonp_callback_"+Math.round(1e5*Math.random());window[n]=function(e){window[n]=void 0,document.body.removeChild(r),t(e)},r.src=e.url+(e.url.indexOf("?")>=0?"&":"?")+"callback="+n+"&"+e.payload,document.body.appendChild(r)},t.cors=function(t,r){var n,a,o="POST";void 0===(new XMLHttpRequest).withCredentials?(n=new window.XDomainRequest,o="GET",t.url=t.url.split("?")[0],t.url=t.url+"?"+t.payload,n.open(o,t.url)):(n=new XMLHttpRequest,n.open(o,t.url),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"));var i=function(t){if(clearTimeout(a),"error"===t.type)return void r({error:{message:"communication error"}});if(4===n.readyState||4!==n.readyState&&""!==n.responseText){var o=e.parse(n.responseText);r(o)}else r({error:{message:"no data"}})};n.onload=i,n.onerror=i,n.send(t.payload),a=window.setTimeout(function(){n.abort(),r({error:{message:"timeout"}})},5e3)},t}(),a=[{code:"visa",format:/(\d{1,4})/g,length:16,regex:/^4/},{code:"mastercard",format:/(\d{1,4})/g,length:16,regex:/^(5[1-5]|2[2-7])/},{code:"amex",format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:15,regex:/^3[47]/},{code:"diners",format:/(\d{1,4})(\d{1,6})?(\d{1,4})?/,length:14,regex:/^3[0689]/},{code:"discover",format:/(\d{1,4})/g,length:16,regex:/^6([045]|22)/},{code:"jcb",format:/(\d{1,4})/g,length:16,regex:/^35/}],o=function(){function e(){}return e.prototype.format=function(e){e=e.replace(/\D/g,"");var t=f.typeByNumber(e);if(!t)return e;var r=e.match(t.format);return r?(t.format.global||r.shift(),r.join(" ").replace(/^\s+|\s+$/gm,"")):e},e}(),i=function(){function e(){}return e.prototype.format=function(e,t){void 0===t&&(t=!1);var r,n,a,o=e.match(/^\D*(\d{1,2})(\D+)?(\d{1,4})?/);return o?(r=o[1]||"",n=o[2]||"",a=o[3]||"",a.length>0?n=" / ":2===r.length||n.length>0?n=" / ":1===r.length&&"0"!==r&&"1"!==r&&(n=" / "),1===r.length&&""!==n&&(r="0"+r),t&&2===a.length&&(a=(new Date).getFullYear().toString().slice(0,2)+a),r+n+a):""},e}(),s=function(){function e(){}return e.prototype.validate=function(e){if(!e)return!1;e=e.replace(/[-\s]/g,"");var t=f.typeByNumber(e);return!!t&&(f.luhnCheck(e)&&e.length===t.length)},e}(),d=function(){function e(){}return e.prototype.validate=function(e){return!!e&&(e=e.replace(/^\s+|\s+$/g,""),!!/^\d+$/.test(e)&&(3<=e.length&&e.length<=4))},e}(),c=function(){function e(){}return e.prototype.validate=function(e){var t,r;if(!e)return!1;var n=e.split("/");if(t=n[0],r=n[1],!t||!r)return!1;if(t=t.replace(/^\s+|\s+$/g,""),r=r.replace(/^\s+|\s+$/g,""),!/^\d+$/.test(t))return!1;if(!/^\d+$/.test(r))return!1;2===r.length&&(r=(new Date).getFullYear().toString().slice(0,2)+r);var a=parseInt(t,10),o=parseInt(r,10);return 1<=a&&a<=12&&new Date(o,a,1)>new Date},e}(),l=function(){function e(){}return e.configureField=function(e){document.getElementById("heartland-field").setAttribute("name",e.field)},e.makeFrame=function(e){var t=document.createElement("iframe");return t.id="heartland-frame-"+e,t.name=e,t.style.border="0",t.frameBorder="0",t.scrolling="no",t.setAttribute("allowtransparency","true"),t},e.addField=function(e,t,r,n){var a=document.createElement("input");a.setAttribute("type",t),a.setAttribute("name",r),a.setAttribute("value",n),document.getElementById(e).appendChild(a)},e.setStyle=function(t,r){var n=document.getElementById(t);n&&n.setAttribute("style",e.encodeEntities(r))},e.appendStyle=function(t,r){var n=document.getElementById(t);if(n){var a=n.getAttribute("style"),o=(a||"")+r;n.setAttribute("style",e.encodeEntities(o))}},e.setText=function(t,r){var n=document.getElementById(t);n&&(n.textContent=e.encodeEntities(r))},e.setValue=function(t,r){var n=document.getElementById(t);n&&void 0!==n.value&&(n.value=e.encodeEntities(r),m.trigger("keyup",n),m.trigger("input",n))},e.setPlaceholder=function(t,r){var n=document.getElementById(t);n&&("•••• •••• •••• ••••"===r||"••••"===r||"•••"===r||"···· ···· ···· ····"===r?n.setAttribute("placeholder",r):n.setAttribute("placeholder",e.encodeEntities(r)))},e.resizeFrame=function(e){var t=document.body.offsetHeight+1;e.Messages.post({action:"resize",height:t},"parent")},e.setFieldData=function(t,r){var n=document.getElementById(t);!n&&document.getElementById("heartland-field")&&(n=document.createElement("input"),n.setAttribute("id",e.encodeEntities(t)),n.setAttribute("type","hidden"),document.getElementById("heartland-field-wrapper").appendChild(n)),n&&n.setAttribute("value",e.encodeEntities(r))},e.getFieldData=function(e,t){var r=document.getElementById(t);r&&e.Messages.post({action:"passData",value:r.value},"parent")},e.addStylesheet=function(e){var t=document.createElement("style"),r=document.getElementsByTagName("head");t.type="text/css",t.appendChild(document.createTextNode(e)),r&&r[0]&&r[0].appendChild(t)},e.json2css=function(t){var r,n,a,o,i,s,d="";if(r=e.jsonAttributes(t)){var c=r.length;for(a=0;a<c;a++)if(i=r[a],s=t[i],e.isArray(s)){var l=s.length;for(o=0;o<l;o++)d+=i+":"+s[o]+";"}else d+=i+":"+s+";"}if(n=e.jsonChildren(t)){var u=n.length;for(a=0;a<u;a++)i=n[a],s=t[i],d+=i+"{"+e.json2css(s)+"}"}return d},e.setFocus=function(){var e=document.getElementById("heartland-field");e&&e.focus()},e.addCertAlert=function(e){var t=document.createElement("div"),r=document.createTextNode("This page is currently in test mode. Do not use real/active card numbers.");t.appendChild(r),t.style.display="block",t.style.width="100%",t.style.marginBottom="5px",t.style.color="#fff",t.style.backgroundColor="#770000",t.style.padding="8px 5px",t.style.fontFamily="Verdana",t.style.fontWeight="100",t.style.fontSize="12px",t.style.textAlign="center",t.style.boxSizing="border-box";var n=document.getElementById(e),a=document.getElementById("heartland-frame-cardNumber");if(a)n.insertBefore(t,a);else{var o=document.getElementById("heartland-frame-heartland-frame-securesubmit");n.insertBefore(t,o)}},e.encodeEntities=function(e){return e.replace(/&/g,"&amp;").replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,function(e){return"&#"+(1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320)+65536)+";"}).replace(/([^\#-~| |!])/g,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")},e.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},e.jsonAttributes=function(t){var r=[];for(var n in t)t.hasOwnProperty(n)&&("string"==typeof t[n]||e.isArray(t[n]))&&r.push(n);return r},e.jsonChildren=function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&"[object Object]"===Object.prototype.toString.call(e[r])&&t.push(r);return t},e}(),u=function(){function e(){}return e.prototype.format=function(e,t){void 0===t&&(t=!1);var r,n,a,o=e.match(/^\D*(\d{1,2})(\D+)?(\d{1,4})?/);return o?(r=o[1]||"",n=o[2]||"",a=o[3]||"",a.length>0?n=" / ":2===r.length||n.length>0?n=" / ":1===r.length&&"0"!==r&&"1"!==r&&(n=" / "),1===r.length&&""!==n&&(r="0"+r),t&&2===a.length&&(a=(new Date).getFullYear().toString().slice(0,2)+a),r+n+a):""},e}(),p=function(){function e(){}return e.listen=function(e,t,r){document.addEventListener?e.addEventListener(t,r,!1):e===document?document.documentElement.attachEvent("onpropertychange",function(e){e.propertyName===t&&r(e)}):e.attachEvent("on"+t,r)},e.trigger=function(e,t){if(document.createEvent){var r=document.createEvent("Event");r.initEvent(t,!0,!0),e.dispatchEvent(r)}else document.documentElement[t]++},e.ignore=function(e,t){document.removeEventListener?document.removeEventListener(e,t,!1):document.documentElement.detachEvent("onpropertychange",function(r){r.propertyName===e&&t(r)})},e}(),m=function(){function t(){}return t.addHandler=function(e,t,r){var n;n="string"==typeof e?document.getElementById(e):e,document.addEventListener?n.addEventListener(t,r,!1):p.listen(n,t,r)},t.removeHandler=function(e,t,r){var n;n="string"==typeof e?document.getElementById(e):e,document.removeEventListener?n.removeEventListener(t,r,!1):p.ignore(t,r)},t.trigger=function(e,t,r,n){if(void 0===n&&(n=!1),document.createEvent){var a=document.createEvent("Event");a.initEvent(e,!0,!0),t.dispatchEvent(a)}else p.trigger(t,e)},t.frameHandleWith=function(r){return function(n){switch(n.action){case"tokenize":if(n.accumulateData){r.Messages.post({action:"accumulateData"},"parent");var a=document.getElementById("tokenizeOptions");a||(a=document.createElement("input"),a.id="tokenizeOptions",a.type="hidden");var o=document.getElementById("publicKey");o||(o=document.createElement("input"),o.id="publicKey",o.type="hidden"),n.data?(a.value=e.stringify(n.data),o.value=n.data.publicKey):(a.value=e.stringify({publicKey:n.message}),o.value=n.message),document.getElementById("heartland-field-wrapper").appendChild(a),document.getElementById("heartland-field-wrapper").appendChild(o)}else t.tokenizeIframe(r,n.data);break;case"setStyle":l.setStyle(n.id,n.style),l.resizeFrame(r);break;case"appendStyle":l.appendStyle(n.id,n.style),l.resizeFrame(r);break;case"setText":l.setText(n.id,n.text),l.resizeFrame(r);break;case"setValue":l.setValue(n.id,n.text);break;case"setPlaceholder":l.setPlaceholder(n.id,n.text);break;case"setFieldData":if(l.setFieldData(n.id,n.value),document.getElementById("heartland-field")&&document.getElementById("cardCvv")&&document.getElementById("cardExpiration")){var i=document.getElementById("tokenizeOptions"),s=document.getElementById("publicKey");t.tokenizeIframe(r,i&&"undefined"!==i.getAttribute("value")?e.parse(i.getAttribute("value")):{publicKey:s.getAttribute("value")})}break;case"getFieldData":l.getFieldData(r,n.id);break;case"addStylesheet":l.addStylesheet(n.data),l.resizeFrame(r);break;case"setFocus":l.setFocus()}}},t.tokenizeIframe=function(e,t){var r={},n=document.getElementById("heartland-field")||document.getElementById("heartland-card-number"),a=document.getElementById("cardCvv")||document.getElementById("heartland-cvv"),o=document.getElementById("cardExpiration"),i=function(t){return function(r){e.Messages.post({action:t,response:r},"parent"),a&&(a.parentNode?a.parentNode.removeChild(a):a.remove()),o&&(o.parentNode?o.parentNode.removeChild(o):o.remove())}};if(r.number=n?n.value:"",r.cvv=a?a.value:"",r.exp=o,r.exp){var s=new u,d=s.format(r.exp.value,!0).split("/");r.expMonth=d[0],r.expYear=d[1],r.exp=void 0}else r.expMonth=document.getElementById("heartland-expiration-month").value,r.expYear=document.getElementById("heartland-expiration-year").value;e.tokenize({cardCvv:r.cvv?r.cvv:"",cardExpMonth:r.expMonth?r.expMonth:"",cardExpYear:r.expYear?r.expYear:"",cardNumber:r.number?r.number:"",cca:t.cca,error:i("onTokenError"),publicKey:t.publicKey?t.publicKey:"",success:i("onTokenSuccess"),type:"pan"})},t.addFieldFrameFocusEvent=function(e){var t=document.getElementById("heartland-field");document.onfocusin?document.addEventListener("focusin",function(e){event.fromElement!==t&&(event.relatedTarget||t.focus())},!1):document.addEventListener("focus",function(e){t.focus()},!1)},t}(),f=function(){function e(){}return e.typeByNumber=function(e){var t,r;if(!e)return null;if(e.replace(/^\s+|\s+$/gm,"").length<4)return null;for(r in a)if((t=a[r])&&t.regex&&t.regex.test(e))break;return t},e.typeByTrack=function(t,r,n){void 0===r&&(r=!1);var a;if(r&&n&&"02"===n)a=t.split("=")[0];else{var o=t.split("%");o[1]&&(o=o[1].split("^"),o[0]&&(a=o[0].toString().substr(1)))}return e.typeByNumber(a)},e.luhnCheck=function(e){var t,r=!0,n=0,a=0;if(!e)return!1;var o=e.split("").reverse(),i=o.length;for(n;n<i;n++)t=parseInt(o[n],10),(r=!r)&&(t*=2),t>9&&(t-=9),a+=t;return a%10==0},e.addType=function(t){var r=t.currentTarget?t.currentTarget:t.srcElement,n=e.typeByNumber(r.value),a=r.className.split(" "),o=a.length,i=0,s="";for(i;i<o;i++)(s=a[i])&&-1!==s.indexOf("card-type-")&&delete a[i];n&&a.push("card-type-"+n.code),r.className=a.join(" ").replace(/^\s+|\s+$/gm,"")},e.formatNumber=function(e){var t=e.currentTarget?e.currentTarget:e.srcElement,r=t.value;if(0!==r.length){var n=(new o).format(r);if(t.value=n,t.setSelectionRange){var a=t.selectionStart;r.length<n.length&&(a+=n.length-r.length)," "===r.charAt(a)&&" "===n.charAt(a-1)&&(a+=1),t.setSelectionRange(a,a)}}},e.formatExpiration=function(e){var t=e.currentTarget?e.currentTarget:e.srcElement,r=t.value;-1!==[46,8].indexOf(e.keyCode)||e.keyCode>=35&&e.keyCode<=39||(t.value=(new i).format(r,"blur"===e.type))},e.restrictLength=function(e){return function(t){var r=t.currentTarget?t.currentTarget:t.srcElement,n=r.value;-1!==[46,8,9,27,13,110].indexOf(t.keyCode)||65===t.keyCode&&!0===t.ctrlKey||t.keyCode>=35&&t.keyCode<=39||n.length>=e&&(t.preventDefault?t.preventDefault():t.returnValue=!1)}},e.restrictNumeric=function(e){-1!==[46,8,9,27,13,110].indexOf(e.keyCode)||65===e.keyCode&&!0===e.ctrlKey||e.keyCode>=35&&e.keyCode<=39||229===e.keyCode||(e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},e.deleteProperly=function(e){var t=e.currentTarget?e.currentTarget:e.srcElement,r=t.value;if(t.setSelectionRange){var n=t.selectionStart;-1!==[46,8].indexOf(e.keyCode)&&" "===r.charAt(n-1)&&t.setSelectionRange(n-1,n-1)}},e.validateNumber=function(e){for(var t=e.currentTarget?e.currentTarget:e.srcElement,r=t.value,n=t.className.split(" "),a=n.length,o="",i=0;i<a;i++)o=n[i],-1!==o.indexOf("valid")&&delete n[i];(new s).validate(r)?n.push("valid"):n.push("invalid"),t.className=n.join(" ").replace(/^\s+|\s+$/gm,"")},e.validateCvv=function(e){for(var t=e.currentTarget?e.currentTarget:e.srcElement,r=t.value,n=t.className.split(" "),a=n.length,o="",i=0;i<a;i++)o=n[i],-1!==o.indexOf("valid")&&delete n[i];(new d).validate(r)?n.push("valid"):n.push("invalid"),t.className=n.join(" ").replace(/^\s+|\s+$/gm,"")},e.validateExpiration=function(e){for(var t=e.currentTarget?e.currentTarget:e.srcElement,r=t.value,n=t.className.split(" "),a=n.length,o="",i=0;i<a;i++)o=n[i],-1!==o.indexOf("valid")&&delete n[i];(new c).validate(r)?n.push("valid"):n.push("invalid"),t.className=n.join(" ").replace(/^\s+|\s+$/gm,"")},e.attachNumberEvents=function(t){m.addHandler(document.querySelector(t),"keydown",e.restrictNumeric),m.addHandler(document.querySelector(t),"keydown",e.restrictLength(19)),m.addHandler(document.querySelector(t),"keydown",e.deleteProperly),m.addHandler(document.querySelector(t),"keyup",e.formatNumber),m.addHandler(document.querySelector(t),"input",e.formatNumber),m.addHandler(document.querySelector(t),"input",e.validateNumber),m.addHandler(document.querySelector(t),"input",e.addType)},e.attachExpirationEvents=function(t){m.addHandler(document.querySelector(t),"keydown",e.restrictNumeric),m.addHandler(document.querySelector(t),"keydown",e.restrictLength(9)),m.addHandler(document.querySelector(t),"keyup",e.formatExpiration),m.addHandler(document.querySelector(t),"blur",e.formatExpiration),m.addHandler(document.querySelector(t),"input",e.validateExpiration),m.addHandler(document.querySelector(t),"blur",e.validateExpiration)},e.attachCvvEvents=function(t){m.addHandler(document.querySelector(t),"keydown",e.restrictNumeric),m.addHandler(document.querySelector(t),"keydown",e.restrictLength(4)),m.addHandler(document.querySelector(t),"input",e.validateCvv)},e}();Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){for(var r=t||0,n=this.length;r<n;r++)if(this[r]===e)return r;return-1});var h,g=Object.freeze({CardNumber:o,Expiration:i}),v={_method:"post",buttonTarget:"",cardCvv:"",cardExpMonth:"",cardExpYear:"",cardNumber:"",cardType:"",env:"prod",error:null,fields:{},formId:"",gatewayUrl:"",iframeTarget:"",ktb:"",object:"token",onEvent:null,onTokenError:null,onTokenSuccess:null,pinBlock:"",publicKey:"",success:null,targetType:"",tokenType:"supt",track:"",trackNumber:"",type:"pan",useDefaultStyles:!0},y=["cardNumber","cardCvv","cardExpiration","submit"],b={CERT:"https://cert.api2.heartlandportico.com/Hps.Exchange.PosGateway.Hpf.v1/api/token",PROD:"https://api2.heartlandportico.com/SecureSubmit.v1/api/token",iframeCERT:"https://hps.github.io/token/",iframePROD:"https://api2.heartlandportico.com/SecureSubmit.v1/token/"},E=function(){function t(e){this.hps=e,this.intervalId=null,this.lastHash="",this.pushIntervalStarted=!1}return t.prototype.pushMessages=function(t){return function(){var r,n,a=[],o=[],i=0,s="",d=/^#?\d+&/,c=t.mailbox.length;if(c){for(i=0;i<c;i++)r=t.mailbox.shift(),s||(s=r.targetUrl,n=r.targetNode),o.push(r.message);if(r=null,d.test(window.location.hash)&&(r=e.parse(decodeURIComponent(window.location.hash.replace(d,""))),a.concat(r)),o!==[]){t.cacheBust=t.cacheBust||1,a.push({data:o,source:{name:t.field||"parent"}});var l=e.stringify(a),u=s.replace(/#.*$/,"")+"#"+ +new Date+t.cacheBust+++"&"+encodeURIComponent(l);n.location?n.location.href=u:n.src=u}o.length=0,t.mailbox.length=0}}},t.prototype.post=function(t,r){var n;if(t.source=t.source||{},t.source.name=window.name,this.hps.frames){var a=this.hps.frames[r]||this.hps[r];if(a){var o=this.hps.frames[r].url;try{void 0!==a.targetNode?n=a.targetNode:void 0!==a.frame&&(n=a.frame)}catch(e){n=a}window.postMessage?n.postMessage(e.stringify(t),o):(this.hps.mailbox=this.hps.mailbox||[],this.hps.mailbox.push({message:t,targetNode:n,targetUrl:o}),this.pushIntervalStarted||setInterval(this.pushMessages(this.hps),10))}}},t.prototype.receive=function(t,r){window.postMessage?(this.callback=function(r){try{t(e.parse(r.data))}catch(e){}},window.addEventListener?window.addEventListener("message",this.callback,!1):window.attachEvent("onmessage",this.callback)):(this.intervalId&&clearInterval(this.intervalId),this.intervalId=null,t&&(this.intervalId=setInterval(function(){var r=document.location.hash,n=/^#?\d+&/;if(r!==this.lastHash&&n.test(r)){var a=e.parse(decodeURIComponent(r.replace(n,"")));this.lastHash=r;for(var o in a){var i=a[o];if("[object Array]"===Object.prototype.toString.call(i.data))for(var s in i.data)t({data:i.data[s],source:i.source});else t(i)}}},100))),m.trigger("receiveMessageHandlerAdded",document)},t.prototype.removeReceiver=function(){window.addEventListener?window.removeEventListener("message",this.callback,!1):window.detachEvent("onmessage",this.callback)},t.prototype.dispose=function(){this.removeReceiver(),this.intervalId&&clearInterval(this.intervalId)},t}();!function(e){e.Defaults={body:function(e){e.setStyle("heartland-body","margin: 0;font-family: Arial, 'Helvetica Neue', Helvetica, sans-serif;color: #666;")},cvv:function(e){e.appendStyle("heartland-cvv","width: 110px;")},cvvContainer:function(e){e.setStyle("heartland-cvv-container","width: 110px;display: inline-block;float: left;")},fieldset:function(e){e.setStyle("heartland-expiration-date-container","border: 0;margin: 0 25px 0px 1px;padding: 0;width: 173px;display: inline-block;float:  left;")},inputsAndSelects:function(e){var t=["heartland-card-number","heartland-expiration-month","heartland-expiration-year","heartland-cvv"],r=t.length,n=0;for(n;n<r;n++)e.setStyle(t[n],"width: 309px;padding: 5px;font-size: 14px;margin: 3px 0px 15px 0px;border: 1px #ccc solid;background-image: -ms-linear-gradient(bottom, #F7F7F7 0%, #EFEFEF 100%);background-image: -moz-linear-gradient(bottom, #F7F7F7 0%, #EFEFEF 100%);background-image: -o-linear-gradient(bottom, #F7F7F7 0%, #EFEFEF 100%);background-image: -webkit-gradient(linear, left bottom, left top, color-stop(0, #F7F7F7), color-stop(1, #EFEFEF));background-image: -webkit-linear-gradient(bottom, #F7F7F7 0%, #EFEFEF 100%);background-image: linear-gradient(to top, #F7F7F7 0%, #EFEFEF 100%);")},labelsAndLegend:function(e){var t=["heartland-card-number-label","heartland-expiration-date-legend","heartland-expiration-month-label","heartland-expiration-year-label","heartland-cvv-label"],r=t.length,n=0;for(n;n<r;n++)e.setStyle(t[n],"font-size: 13px;text-transform: uppercase;font-weight: bold;display: block;width: 100%;clear: both;")},selectLabels:function(e){var t=["heartland-expiration-month-label","heartland-expiration-year-label"],r=t.length,n=0;for(n;n<r;n++)e.setStyle(t[n],"position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0;")},selects:function(e){var t=["heartland-expiration-month","heartland-expiration-year"],r=t.length,n=0;for(n;n<r;n++)e.appendStyle(t[n],"border: 0;outline: 1px solid #ccc;height: 28px;width: 80px;-webkit-appearance: none;-moz-appearance: none;-webkit-border-radius: 0px;background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAGCAYAAAD68A/GAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDE0IDc5LjE1Njc5NywgMjAxNC8wOC8yMC0wOTo1MzowMiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTQgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QzA5MTZFN0RFMDY2MTFFNEIyODZFMURFRTA3REUxMjciIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QzA5MTZFN0VFMDY2MTFFNEIyODZFMURFRTA3REUxMjciPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpDMDkxNkU3QkUwNjYxMUU0QjI4NkUxREVFMDdERTEyNyIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpDMDkxNkU3Q0UwNjYxMUU0QjI4NkUxREVFMDdERTEyNyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PvMrdUAAAABiSURBVHjaYkxLS3vNwMAgwoAfvGUCEjkMhEE285kzZ65u2bLlJ5DjgkNRxUwgYPz//z+Yl56ePhNIpaEpAqnJADGYkASzgHgnEn8HyEoYB24i1FReILUPynUEmvYFJgcQYACYah+uDhpKGAAAAABJRU5ErkJggg==);background-position: 65px 12px;background-repeat: no-repeat;background-color:  #F7F7F7;float: left;margin-right: 6px")}}}(h||(h={}));var k=function(){function e(){}return e.configureIframe=function(t){var r,n,a=t.options,o=!0;t.Messages=t.Messages||new E(t),"cert"===a.env?t.iframe_url=b.iframeCERT:t.iframe_url=b.iframePROD,a.fields!==v.fields&&e.makeFieldsAndLink(t),a.fields===v.fields&&a.iframeTarget&&(n=document.getElementById(a.iframeTarget),"myframe"===a.targetType?(r=n,t.iframe_url=r.src):(r=l.makeFrame("heartland-frame-securesubmit"),n.appendChild(r)),t.iframe_url=t.iframe_url+"#"+encodeURIComponent(document.location.href.split("#")[0]),r.src=t.iframe_url,t.frames.child={frame:window.postMessage?r.contentWindow:r,name:"child",url:t.iframe_url}),!1===a.useDefaultStyles&&(o=!1),a.buttonTarget&&(t.clickHandler=function(e){return e.preventDefault(),t.Messages.post({accumulateData:!!t.frames.cardNumber,action:"tokenize",data:{publicKey:a.publicKey}},t.frames.cardNumber?"cardNumber":"child"),!1},m.addHandler(a.buttonTarget,"click",t.clickHandler)),t.Messages.receive(function(e){var n;try{n=t.frames["heartland-frame-securesubmit"===e.source.name?"parent":e.source.name]}catch(e){return}switch(e.action){case"requestTokenize":t.Messages.post({accumulateData:!!t.frames.cardNumber,action:"tokenize",data:a},t.frames.cardNumber?"cardNumber":"child");break;case"onTokenSuccess":a.onTokenSuccess(e.response);break;case"onTokenError":a.onTokenError(e.response);break;case"resize":n?t.resizeIFrame(n.frame,e.height):t.resizeIFrame(r,e.height);break;case"receiveMessageHandlerAdded":if(!a.fields&&o&&(h.Defaults.body(t),h.Defaults.labelsAndLegend(t),h.Defaults.inputsAndSelects(t),h.Defaults.fieldset(t),h.Defaults.selects(t),h.Defaults.selectLabels(t),h.Defaults.cvvContainer(t),h.Defaults.cvv(t)),n&&n.options.placeholder&&t.Messages.post({action:"setPlaceholder",id:"heartland-field",text:n.options.placeholder},n.name),n&&n.options.value&&t.Messages.post({action:"setValue",id:"heartland-field",text:n.options.value},n.name),a.style){var i=a.styleString||(a.styleString=l.json2css(a.style));t.Messages.post({action:"addStylesheet",data:i},n.name)}m.trigger("securesubmitIframeReady",document);break;case"accumulateData":for(var s in t.frames)if("submit"!==s&&"cardNumber"!==s){var d=t.frames[s];t.Messages.post({action:"getFieldData",id:"heartland-field"},d.name)}break;case"passData":var c=t.frames.cardNumber;if(!c)break;t.Messages.post({action:"setFieldData",id:n.name,value:e.value},c.name);break;case"fieldEvent":if(!a.onEvent)break;a.onEvent(e.event);break;case"error":if(!a.onError)break;a.onError(e);break;case"setAutocompleteValue":t.Messages.post({action:"setValue",id:"heartland-field",text:e.data.text},e.data.target)}},"*")},e.makeFieldsAndLink=function(e){for(var t=e.options,r=y.length,n=e.iframe_url.replace("index.html","")+"2.4.0/",a=0;a<r;a++){var o=y[a],i=t.fields[o];if(!i)return;var s=l.makeFrame(o),d=n;"submit"===o?d+="button.html":t.cca&&"cert"===t.env?d+="fieldCca.cert.html":t.cca&&"prod"===t.env?d+="fieldCca.prod.html":d+="field.html",d=d+"#"+o+":"+encodeURIComponent(document.location.href.split("#")[0]),s.src=d,document.getElementById(i.target).appendChild(s),e.frames[o]={frame:s,name:o,options:i,target:i.target,targetNode:window.postMessage?s.contentWindow:s,url:d}}},e.monitorFieldEvents=function(e,t){var r=["click","blur","focus","change","keypress","keydown","keyup"],n=0,a=r.length;for(n;n<a;n++){var o=r[n];m.addHandler(t,o,function(t){var r=document.getElementById("heartland-field"),n=[],a={};""!==r.className&&(n=r.className.split(" ")),e.Messages.post({action:"fieldEvent",event:{classes:n,data:a,source:window.name,type:t.type}},"parent")})}},e}(),w=function(){function e(){}return e.getCardType=function(e,t){var r,n="",a="unknown";switch(e){case"swipe":n=t.track,r=f.typeByTrack(n);break;case"encrypted":n=t.track,r=f.typeByTrack(n,!0,t.trackNumber);break;default:n=t.cardNumber,r=f.typeByNumber(n)}return r&&(a=r.code),a},e.applyOptions=function(e,t){var r={};e||(e={});for(var n in e)e.hasOwnProperty(n)&&(r[n]=e[n]);for(var n in t)t.hasOwnProperty(n)&&(r[n]=t[n]);return r},e.throwError=function(e,t){if("function"==typeof e.error)return void e.error(t);if(t.error)throw new Error(t.error.message);throw new Error(t)},e.getItemByPropertyValue=function(e,t,r){var n=e.length,a=0;for(a;a<n;a++)if(e[a][t]===r)return e[a]},e.getParams=function(t,r){var n=[];switch(t){case"iframe":case"pan":n.push("token_type=supt","object=token","_method=post","api_key="+r.publicKey.replace(/^\s+|\s+$/g,""),"card%5Bnumber%5D="+r.cardNumber.replace(/\s/g,""),"card%5Bexp_month%5D="+r.cardExpMonth.replace(/^\s+|\s+$/g,""),"card%5Bexp_year%5D="+r.cardExpYear.replace(/^\s+|\s+$/g,""),"card%5Bcvc%5D="+r.cardCvv.replace(/^\s+|\s+$/g,""));break;case"swipe":n.push("token_type=supt","object=token","_method=post","api_key="+r.publicKey.replace(/^\s+|\s+$/g,""),"card%5Btrack_method%5D=swipe","card%5Btrack%5D="+encodeURIComponent(r.track.replace(/^\s+|\s+$/g,"")));break;case"encrypted":n.push("token_type=supt","object=token","_method=post","api_key="+r.publicKey.replace(/^\s+|\s+$/g,""),"encryptedcard%5Btrack_method%5D=swipe","encryptedcard%5Btrack%5D="+encodeURIComponent(r.track.replace(/^\s+|\s+$/g,"")),"encryptedcard%5Btrack_number%5D="+encodeURIComponent(r.trackNumber.replace(/^\s+|\s+$/g,"")),"encryptedcard%5Bktb%5D="+encodeURIComponent(r.ktb.replace(/^\s+|\s+$/g,"")),"encryptedcard%5Bpin_block%5D="+encodeURIComponent(r.pinBlock.replace(/^\s+|\s+$/g,"")));break;default:e.throwError(r,"unknown params type")}return n.join("&")},e.getUrlByEnv=function(e){return e.env=e.publicKey.split("_")[1],"cert"===e.env?e.gatewayUrl=b.CERT:e.gatewayUrl=b.PROD,e},e.addFormHandler=function(t){var r=document.getElementById(t.formId),a=function(r){r.preventDefault?r.preventDefault():window.event&&(window.event.returnValue=!1);var a=e.getFields(t.formId);t.cardNumber=a.number,t.cardExpMonth=a.expMonth,t.cardExpYear=a.expYear,t.cardCvv=a.cvv,t.cardType=e.getCardType("pan",t),n.call("pan",t)};m.addHandler(r,"submit",a),l.addField(t.formId,"hidden","publicKey",t.publicKey)},e.getFields=function(e){var t,r=document.getElementById(e),n={},a=r.childElementCount;for(t=0;t<a;t++){var o=r.children[t];"card_number"===o.id?n.number=o.value:"card_expiration_month"===o.id?n.expMonth=o.value:"card_expiration_year"===o.id?n.expYear=o.value:"card_cvc"===o.id&&(n.cvv=o.value)}return n},e}(),x=function(){function e(e,t){void 0===t&&(t="pan"),this.url=e,this.type=t}return e.prototype.tokenize=function(e,t){var r=this;this.requestData=e,n.jsonp(this.buildRequest(e),function(e){t(r.deserializeResponseData(e))})},e.prototype.buildRequest=function(e){return new t(this.url,this.serializeRequestData(e))},e.prototype.serializeRequestData=function(e){return w.getParams(this.type,e)},e.prototype.deserializeResponseData=function(e){if(e.error)return e;var t=w.getCardType(this.type,this.requestData),r=e.card||e.encryptedcard,n=r.number.slice(-4);return e.last_four=n,e.card_type=t,e.exp_month=this.requestData.cardExpMonth,e.exp_year=this.requestData.cardExpYear,e},e}(),I=function(){function e(e){this.jwt=e}return e.prototype.tokenize=function(e,t){var r=this,n=this.buildRequest(e),a=window.Cardinal,o=function(e,n){e.jwt=n,
t(r.deserializeResponseData(e))};a.__secureSubmitFrameInit||(a.setup("init",{jwt:this.jwt}),a.on("payments.validated",o),a.__secureSubmitFrameInit=!0),a.trigger("jwt.update",this.jwt),a.start("cca",n.payload)},e.prototype.buildRequest=function(e){return new r({Consumer:{Account:{AccountNumber:e.cardNumber.replace(/\D/g,""),CardCode:e.cardCvv.replace(/^\s+|\s+$/g,""),ExpirationMonth:e.cardExpMonth.replace(/^\s+|\s+$/g,""),ExpirationYear:e.cardExpYear.replace(/^\s+|\s+$/g,"")}},Options:{EnableCCA:!1},OrderDetails:{OrderNumber:e.cca.orderNumber}})},e.prototype.serializeRequestData=function(e){return e},e.prototype.deserializeResponseData=function(e){return void 0!==e.Token&&"undefined"!==e.Token.Token&&"0"===e.Token.ReasonCode?this.deserializeSuccessResponse(e):this.deserializeFailureResponse(e)},e.prototype.deserializeSuccessResponse=function(e){return{jwt:e.jwt,token_value:e.Token.Token}},e.prototype.deserializeFailureResponse=function(e){var t=e.ErrorDescription;return e.Token&&""!==e.Token.ReasonDescription&&(t=e.Token.ReasonDescription),{error:{message:t}}},e}(),F=function(){function e(e){if(e||!window.parent)return this.options=w.applyOptions(v,e),this.options=w.getUrlByEnv(this.options),this.options.formId.length>0&&w.addFormHandler(this.options),this.frames={},"iframe"===this.options.type&&(this.iframe_url="",this.Messages=new E(this),this.mailbox=[],this.cacheBust=1,k.configureIframe(this),"cert"===this.options.env&&(""!==this.options.iframeTarget?l.addCertAlert(this.options.iframeTarget):l.addCertAlert(this.options.fields.cardNumber.target))),this}return e.prototype.tokenize=function(e){var t=this;if(e=e||{},e&&(this.options=w.applyOptions(this.options,e),this.options=w.getUrlByEnv(this.options)),"iframe"===this.options.type&&this.frames.cardNumber)return void this.Messages.post({accumulateData:!!this.frames.cardNumber,action:"tokenize",data:{publicKey:this.options.publicKey}},"cardNumber");if("iframe"===this.options.type)return void this.Messages.post({action:"tokenize",data:{publicKey:this.options.publicKey}},"child");var r={cardinal:null,heartland:null},n=function(e){if(e.error)w.throwError(t.options,e);else{if(t.options.formId&&t.options.formId.length>0){var r=e.heartland||e;l.addField(t.options.formId,"hidden","token_value",r.token_value),l.addField(t.options.formId,"hidden","last_four",r.last_four),l.addField(t.options.formId,"hidden","card_exp_year",r.exp_year),l.addField(t.options.formId,"hidden","card_exp_month",r.exp_month),l.addField(t.options.formId,"hidden","card_type",r.card_type)}t.options.success(e)}},a=function(e){return function(a){r[e]=a,t.options.cca&&r.cardinal&&r.heartland&&n(r),!t.options.cca&&r.heartland&&n(r.heartland)}};new x(this.options.gatewayUrl,this.options.type).tokenize(this.options,a("heartland")),this.options.cca&&new I(this.options.cca.jwt).tokenize(this.options,a("cardinal"))},e.prototype.configureInternalIframe=function(e){this.Messages=new E(this),this.parent=window.parent,this.frames=this.frames||{},this.frames.parent={frame:window.parent,name:"parent",url:decodeURIComponent(document.location.hash.replace(/^#/,""))},this.loadHandler=function(e){return function(){l.resizeFrame(e)}}(this),this.receiveMessageHandlerAddedHandler=function(e){return function(){e.Messages.post({action:"receiveMessageHandlerAdded"},"parent")}}(this),m.addHandler(window,"load",this.loadHandler),m.addHandler(document,"receiveMessageHandlerAdded",this.receiveMessageHandlerAddedHandler),this.Messages.receive(m.frameHandleWith(this),"*")},e.prototype.configureButtonFieldIframe=function(e){this.configureFieldIframe(e),m.addHandler("heartland-field","click",function(e){return function(t){t.preventDefault?t.preventDefault():t.returnValue=!1,e.Messages.post({action:"requestTokenize"},"parent")}}(this))},e.prototype.configureFieldIframe=function(e){var t=document.location.hash.replace(/^#/,""),r=t.split(":");this.Messages=new E(this),this.field=r.shift(),this.parent=window.parent,this.frames=this.frames||{},this.frames.parent={frame:window.parent,name:"parent",url:decodeURIComponent(r.join(":").replace(/^:/,""))},window.onerror=function(e){return function(t,r,n,a,o){return e.Messages.post({action:"error",data:{column:a,errorMsg:t,lineNumber:n,url:r}},"parent"),!0}}(this),this.loadHandler=function(e){return function(){l.resizeFrame(e),l.configureField(e);var t="attach"+window.name.replace("card","")+"Events";if(f[t]&&f[t]("#heartland-field"),m.addFieldFrameFocusEvent(e),"cardNumber"===window.name){var r=document.getElementById("heartland-field-wrapper"),n=document.getElementById("heartland-field"),a=document.createElement("input"),o=document.createElement("input");a.className="autocomplete-hidden",o.className="autocomplete-hidden",a.tabIndex=-1,o.tabIndex=-1,n.autocomplete="cc-number",a.autocomplete="cc-csc",o.autocomplete="cc-exp",m.addHandler(a,"input",function(){e.Messages.post({action:"setAutocompleteValue",data:{target:"cardCvv",text:a.value}},"parent")}),m.addHandler(o,"input",function(){e.Messages.post({action:"setAutocompleteValue",data:{target:"cardExpiration",text:o.value}},"parent")}),r.appendChild(a),r.appendChild(o)}}}(this),this.receiveMessageHandlerAddedHandler=function(e){return function(){e.Messages.post({action:"receiveMessageHandlerAdded"},"parent")}}(this),m.addHandler(window,"load",this.loadHandler),m.addHandler(document,"receiveMessageHandlerAdded",this.receiveMessageHandlerAddedHandler),k.monitorFieldEvents(this,"heartland-field"),this.Messages.receive(m.frameHandleWith(this),"*")},e.prototype.resizeIFrame=function(e,t){e&&(e.style.height=parseInt(t,10)+"px")},e.prototype.setText=function(e,t){this.Messages.post({action:"setText",id:e,text:t},"child")},e.prototype.setStyle=function(e,t){this.Messages.post({action:"setStyle",id:e,style:t},"child")},e.prototype.appendStyle=function(e,t){this.Messages.post({action:"appendStyle",id:e,style:t},"child")},e.prototype.setFocus=function(e){this.Messages.post({action:"setFocus"},e)},e.prototype.dispose=function(){this.Messages.dispose(),this.Messages=null,this.frames.cardNumber&&this.frames.cardNumber.targetNode&&this.removeNode(this.frames.cardNumber.frame),this.frames.cardExpiration&&this.frames.cardExpiration.frame&&this.removeNode(this.frames.cardExpiration.frame),this.frames.cardCvv&&this.frames.cardCvv.frame&&this.removeNode(this.frames.cardCvv.frame),this.frames.child&&this.frames.child.frame&&this.removeNode(this.frames.child.frame),this.clickHandler&&m.removeHandler(this.options.buttonTarget,"click",this.clickHandler),this.loadHandler&&m.removeHandler(window,"load",this.loadHandler),this.receiveMessageHandlerAddedHandler&&m.removeHandler(document,"receiveMessageHandlerAdded",this.receiveMessageHandlerAddedHandler)},e.prototype.removeNode=function(e){e.remove?e.remove():e.parentNode&&e.parentNode.removeChild&&e.parentNode.removeChild(e)},e}(),A=Object.freeze({CardNumber:s,Cvv:d,Expiration:c});return window.HPS=F,{Ajax:n,Card:f,DOM:l,Events:m,Formatter:g,Frames:k,HPS:F,JSON:e,Messages:E,Styles:h,Util:w,Validator:A}}();
//# sourceMappingURL=securesubmit.min.js.map
